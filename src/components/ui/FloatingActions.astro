---
import FloatingButton from "./FloatingButton.astro";
import Tooltip from "./Tooltip.astro";
import Modal from "./Modal.astro";
---

<aside class="fixed bottom-6 right-6 z-50 flex flex-col gap-3 items-end" aria-label="Quick actions">
  <!-- WhatsApp Contact -->
  <Tooltip content="Chat Admin" position="left">
    <a 
      href="https://wa.me/6282225009253?text=Halo%20KF13!%20Saya%20ingin%20bergabung%20dengan%20komunitas"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Hubungi Admin WhatsApp"
    >
      <FloatingButton variant="accent">
        <span class="text-2xl text-on-primary">ğŸ’¬</span>
      </FloatingButton>
    </a>
  </Tooltip>

  <!-- Debug Panel Toggle (Development Only) -->
  {import.meta.env.DEV && (
    <Tooltip content="Debug Panel (DEV)" position="left">
      <FloatingButton 
        variant="primary"
        id="debug-toggle"
        aria-label="Toggle Debug Panel"
      >
        <span class="text-2xl text-on-primary">ğŸ›</span>
      </FloatingButton>
    </Tooltip>
  )}

  <!-- Theme Toggle -->
  <Tooltip content="Toggle Theme" position="left">
    <FloatingButton 
      variant="surface"
      id="theme-toggle-btn"
      aria-label="Toggle Dark Mode"
    >
      <span class="text-2xl">ğŸŒ™</span>
    </FloatingButton>
  </Tooltip>
</aside>

<!-- Dark Mode Coming Soon Modal -->
<Modal id="darkmode-modal" title="ğŸš§ Coming Soon">
  <p style="margin:0">Dark mode sedang dikembangkan. Nantikan update selanjutnya!</p>
</Modal>

<!-- Debug Panel Modal (Development Only) -->
{import.meta.env.DEV && (
  <div id="debug-panel" class="fixed inset-0 bg-black/50 z-50 hidden">
    <div class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-80 bg-white dark:bg-slate-800 border-4 border-dark dark:border-light shadow-brutal">
      <div class="p-4 border-b-4 border-dark dark:border-light bg-purple-500 dark:bg-purple-600">
        <div class="flex justify-between items-center">
          <h3 class="font-black text-white">ğŸ› DEBUG PANEL (DEV)</h3>
          <button id="close-debug" class="text-2xl text-white hover:scale-110 transition-transform">Ã—</button>
        </div>
      </div>
      
      <div class="p-6 space-y-4">
        <!-- Testing Checklist Toggle -->
        <button 
          id="toggle-testing-checklist"
          class="w-full bg-accent dark:bg-accent-dark border-2 border-dark dark:border-light p-3 font-bold text-white hover:scale-105 transition-transform text-left"
        >
          <div class="flex items-center justify-between">
            <span>ğŸ§ª Testing Checklist</span>
            <span id="checklist-status" class="text-sm">Show</span>
          </div>
        </button>

        <!-- Responsive Test Toggle -->
        <button 
          id="toggle-responsive-test"
          class="w-full bg-blue dark:bg-blue-dark border-2 border-dark dark:border-light p-3 font-bold text-light hover:scale-105 transition-transform text-left"
        >
          <div class="flex items-center justify-between">
            <span>ğŸ“± Responsive Test</span>
            <span id="responsive-status" class="text-sm">Show</span>
          </div>
        </button>

        <!-- Test Results Toggle -->
        <button 
          id="toggle-test-results"
          class="w-full bg-green-500 dark:bg-green-600 border-2 border-dark dark:border-light p-3 font-bold text-white hover:scale-105 transition-transform text-left"
        >
          <div class="flex items-center justify-between">
            <span>ğŸ“Š Test Results</span>
            <span class="text-sm">View</span>
          </div>
        </button>

        <!-- Debug Info -->
        <div class="bg-surface dark:bg-slate-700 border-2 border-dark dark:border-light p-3 text-xs text-dark dark:text-light">
          <div class="font-bold mb-1">Debug Info:</div>
          <div>Mode: <span class="text-purple-600 font-bold">DEVELOPMENT</span></div>
          <div>Viewport: <span id="debug-viewport">Loading...</span></div>
          <div>Theme: <span id="debug-theme">Loading...</span></div>
        </div>
      </div>
    </div>
  </div>
)}

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Theme toggle shows modal (dark mode coming soon)
  document.getElementById('theme-toggle-btn')?.addEventListener('click', () => {
    document.getElementById('darkmode-modal')?.classList.remove('hidden');
  });

  // Debug Panel (Development Only)
  const debugToggle = document.querySelector('#debug-toggle');
  const debugPanel = document.querySelector('#debug-panel');
  const closeDebug = document.querySelector('#close-debug');
  
  if (debugToggle && debugPanel) {
    debugToggle.addEventListener('click', () => {
      debugPanel.classList.remove('hidden');
      updateDebugInfo();
    });
    
    closeDebug?.addEventListener('click', () => {
      debugPanel.classList.add('hidden');
    });
    
    // Close panel when clicking outside
    debugPanel.addEventListener('click', (e) => {
      if (e.target === debugPanel) {
        debugPanel.classList.add('hidden');
      }
    });
    
    // ESC key to close
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !debugPanel.classList.contains('hidden')) {
        debugPanel.classList.add('hidden');
      }
    });
  }

  // Debug Panel Controls
  const toggleTestingChecklist = document.querySelector('#toggle-testing-checklist');
  const toggleResponsiveTest = document.querySelector('#toggle-responsive-test');
  const toggleTestResults = document.querySelector('#toggle-test-results');
  
  const checklistStatus = document.querySelector('#checklist-status');
  const responsiveStatus = document.querySelector('#responsive-status');

  toggleTestingChecklist?.addEventListener('click', () => {
    const checklist = document.querySelector('#testing-checklist');
    if (checklist) {
      const isHidden = checklist.classList.contains('hidden');
      if (isHidden) {
        checklist.classList.remove('hidden');
        if (checklistStatus) checklistStatus.textContent = 'Hide';
      } else {
        checklist.classList.add('hidden');
        if (checklistStatus) checklistStatus.textContent = 'Show';
      }
    }
  });

  toggleResponsiveTest?.addEventListener('click', () => {
    const responsiveTest = document.querySelector('#responsive-test');
    if (responsiveTest) {
      const isHidden = responsiveTest.classList.contains('hidden');
      if (isHidden) {
        responsiveTest.classList.remove('hidden');
        if (responsiveStatus) responsiveStatus.textContent = 'Hide';
      } else {
        responsiveTest.classList.add('hidden');
        if (responsiveStatus) responsiveStatus.textContent = 'Show';
      }
    }
  });

  toggleTestResults?.addEventListener('click', () => {
    alert(`ğŸ§ª TEST RESULTS SUMMARY\n\nâœ… Overall Score: 94/100 (EXCELLENT)\nâœ… 31/33 Tests Passed (93.9%)\nâ±ï¸ Load Time: 638-1367ms\nğŸŒ 3 Browsers Tested\nğŸ“± 4 Device Sizes\n\nâœ… READY FOR PRODUCTION\nTested: 25 Dec 2024, 23:05 WIB`);
  });

  // Update debug info
  function updateDebugInfo() {
    const debugViewport = document.querySelector('#debug-viewport');
    const debugTheme = document.querySelector('#debug-theme');
    
    if (debugViewport) {
      debugViewport.textContent = `${window.innerWidth}x${window.innerHeight}`;
    }
    
    if (debugTheme) {
      const isDark = document.documentElement.classList.contains('dark');
      debugTheme.textContent = isDark ? 'Dark' : 'Light';
    }
  }

  // Update debug info on resize
  window.addEventListener('resize', updateDebugInfo);
});
</script>
