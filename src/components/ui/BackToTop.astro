---
interface Props {
  threshold?: number;
}

const { threshold = 300 } = Astro.props;
---

<button
  id="back-to-top"
  class="fixed bottom-6 left-6 z-50 w-12 h-12 btn-secondary font-black text-xl shadow-brutal hover:shadow-brutal-hover transition-all transform hover:scale-110 opacity-0 translate-y-10 pointer-events-none"
  style="position: fixed !important;"
  aria-label="Back to top"
>
  <!-- Progress Border SVG -->
  <svg class="absolute inset-0 w-full h-full" viewBox="0 0 48 48" style="position: absolute;">
    <!-- Background border -->
    <rect
      x="2"
      y="2"
      width="44"
      height="44"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      opacity="0.2"
    />
    <!-- Progress border -->
    <rect
      id="progress-rect"
      x="2"
      y="2"
      width="44"
      height="44"
      fill="none"
      stroke="#1d4ed8"
      stroke-width="2"
      stroke-linecap="round"
      stroke-dasharray="176"
      stroke-dashoffset="176"
      class="transition-all duration-100 ease-out"
    />
  </svg>
  
  <!-- Button Content -->
  <span style="position: relative; z-index: 10;" class="text-dark dark:text-light">â†‘</span>
</button>

<script define:vars={{ threshold }}>
document.addEventListener('DOMContentLoaded', () => {
  const backToTopBtn = document.getElementById('back-to-top');
  const progressRect = document.getElementById('progress-rect');
  
  if (!backToTopBtn || !progressRect) return;
  
  const updateProgress = () => {
    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollPercent = Math.min(Math.max(scrollTop / docHeight, 0), 1);
    
    // Update progress rectangle
    const perimeter = 176; // 4 * 44 (rectangle perimeter)
    const offset = perimeter - (scrollPercent * perimeter);
    progressRect.style.strokeDashoffset = offset.toString();
    
    // Show/hide button based on scroll position
    if (scrollTop > threshold) {
      backToTopBtn.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
      backToTopBtn.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
    } else {
      backToTopBtn.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
      backToTopBtn.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
    }
  };
  
  window.addEventListener('scroll', updateProgress);
  backToTopBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  
  // Initial call
  updateProgress();
});
</script>
