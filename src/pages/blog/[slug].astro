---
import "@/styles/main.css";
import BaseHead from "@/components/BaseHead.astro";
import Navigation from "@/components/Navigation.astro";
import Footer from "@/components/sections/Footer.astro";
import FloatingActions from "@/components/ui/FloatingActions.astro";
import Heading from "@/components/ui/Heading.astro";
import Text from "@/components/ui/Text.astro";
import BrutalCard from "@/components/ui/BrutalCard.astro";
import BrutalSection from "@/components/ui/BrutalSection.astro";
import BackToTop from "@/components/ui/BackToTop.astro";

import { blogPosts } from "../../data/blogPosts";

export async function getStaticPaths() {
  return blogPosts.map(post => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

const { post } = Astro.props;
---

<!doctype html>
<html lang="id" class="scroll-smooth">
    <head>
        <BaseHead 
            title={`${post.title} - KF13 Blog`}
            description={post.excerpt}
        />
        <script>
        </script>
    </head>
    <body class="font-sans bg-surface dark:bg-surface-dark text-dark dark:text-light transition-colors">
        <Navigation />
        <FloatingActions />
        <BackToTop threshold={300} />
        
        <main class="pt-20">
            <BrutalSection background="surface" padding="lg">
                <div class="max-w-4xl mx-auto">
                    <!-- Breadcrumb -->
                    <nav class="mb-8">
                        <div class="flex items-center gap-2 text-sm">
                            <a href="/" class="text-primary dark:text-primary-dark hover:underline font-semibold">Home</a>
                            <span class="text-dark dark:text-light ">‚Üí</span>
                            <a href="/blog" class="text-primary dark:text-primary-dark hover:underline font-semibold">Blog</a>
                            <span class="text-dark dark:text-light ">‚Üí</span>
                            <span class="text-dark dark:text-light ">{post.category}</span>
                        </div>
                    </nav>

                    <!-- Article Meta -->
                    <div class="mb-8">
                        <div class="flex flex-wrap items-center gap-4 mb-6">
                            <span class={`px-3 py-1 text-xs font-bold border-2 border-dark dark:border-light ${
                                post.category === 'Tutorial' ? 'bg-blue text-white' :
                                post.category === 'Eksperimen' ? 'bg-green-500 text-white' :
                                post.category === 'Teori' ? 'bg-purple-500 text-white' :
                                post.category === 'Tips Belajar' ? 'bg-orange-500 text-white' :
                                'bg-pink text-white'
                            }`}>
                            {post.category.toUpperCase()}
                        </span>
                        <span class="text-sm text-dark dark:text-light ">üìÖ {post.date}</span>
                        <span class="text-sm text-dark dark:text-light ">‚è±Ô∏è {post.readTime}</span>
                        <span class="text-sm text-dark dark:text-light ">üë®‚Äçüè´ {post.author}</span>
                    </div>
                    
                    <Heading level={1} size="4xl" weight="extrabold" color="primary">
                        {post.title}
                    </Heading>
                    
                    <Text size="lg" color="dark" class="mb-8">
                        {post.excerpt}
                    </Text>
                    
                    <!-- Tags -->
                    <div class="flex flex-wrap gap-2">
                        {post.tags.map((tag: string) => (
                            <span class="bg-accent dark:bg-accent-dark border border-dark dark:border-light px-2 py-1 text-xs font-semibold text-dark dark:text-light">
                                #{tag}
                            </span>
                        ))}
                    </div>
                </div>
            </BrutalSection>

            <!-- Article Content -->
            <BrutalSection background="white" padding="lg">
                <div class="max-w-4xl mx-auto">
                    <!-- Reading Progress -->
                    <div class="sticky top-20 mb-4 z-10">
                        <div class="bg-surface border-2 border-dark p-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span>Progress Baca</span>
                                <span id="progress-text">0%</span>
                            </div>
                            <div class="w-full bg-white h-2 border border-dark">
                                <div class="bg-primary h-full w-0 transition-all duration-300" id="reading-progress"></div>
                            </div>
                        </div>
                    </div>

                    <BrutalCard variant="surface" size="lg">
                        <div 
                            class="article-content prose prose-lg max-w-none text-dark"
                            set:html={post.content}
                        />
                    </BrutalCard>
                </div>
            </BrutalSection>

            <!-- Article Footer -->
            <BrutalSection background="surface" padding="lg">
                <div class="max-w-4xl mx-auto">
                    <!-- Share Buttons -->
                    <div class="mb-8">
                        <Heading level={3} size="xl" weight="extrabold" color="primary" class="mb-4">üì§ BAGIKAN ARTIKEL</Heading>
                        <div class="flex flex-wrap gap-3">
                            <a 
                                href={`https://wa.me/?text=Baca artikel fisika menarik: ${post.title} https://klubfisika.org/blog/${post.slug}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="bg-green-500 border-2 border-dark dark:border-light px-4 py-2 font-bold text-white hover:scale-105 transition-transform"
                            >
                                üì± WhatsApp
                            </a>
                            <a 
                                href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.title)}&url=https://klubfisika.org/blog/${post.slug}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="bg-blue border-2 border-dark dark:border-light px-4 py-2 font-bold text-white hover:scale-105 transition-transform"
                            >
                                üê¶ Twitter
                            </a>
                            <a 
                                href={`https://www.facebook.com/sharer/sharer.php?u=https://klubfisika.org/blog/${post.slug}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="bg-blue-600 border-2 border-dark dark:border-light px-4 py-2 font-bold text-white hover:scale-105 transition-transform"
                            >
                                üìò Facebook
                            </a>
                        </div>
                    </div>

                    <!-- Author Info -->
                    <div class="bg-accent dark:bg-accent-dark border-4 border-dark dark:border-light p-6 transform -rotate-1 shadow-brutal">
                        <h4 class="text-lg font-black uppercase text-dark dark:text-light mb-3">
                            ‚úçÔ∏è TENTANG PENULIS
                        </h4>
                        <div class="flex items-start gap-4">
                            <div class="w-16 h-16 bg-primary dark:bg-primary-dark border-2 border-dark dark:border-light rounded-full flex items-center justify-center">
                                <span class="text-2xl text-white">üë®‚Äçüî¨</span>
                            </div>
                            <div>
                                <Heading level={5} size="base" weight="bold" color="primary" class="mb-2">{post.author}</Heading>
                                <Text size="sm" color="dark">
                                    Kontributor aktif KF13 yang berpengalaman dalam pembelajaran fisika dan eksperimen praktis.
                                </Text>
                            </div>
                        </div>
                    </BrutalCard>

                    <!-- Navigation -->
                    <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-between">
                        <a 
                            href="/blog"
                            class="bg-secondary dark:bg-secondary-dark border-3 border-dark dark:border-light px-6 py-3 font-black text-dark dark:text-light hover:scale-105 transition-transform text-center"
                        >
                            ‚Üê KEMBALI KE BLOG
                        </a>
                        <a 
                            href="/events"
                            class="bg-primary dark:bg-primary-dark border-3 border-dark dark:border-light px-6 py-3 font-black text-white hover:scale-105 transition-transform text-center"
                        >
                            LIHAT EVENTS ‚Üí
                        </a>
                    </div>
                </div>
            </BrutalSection>
        </main>

        <Footer />

        <style>
            @import "@/styles/main.css";
            
            .article-content h2 {
                @apply text-2xl font-black uppercase text-dark dark:text-light mt-8 mb-4;
            }
            .article-content h3 {
                @apply text-xl font-bold text-dark dark:text-light mt-6 mb-3;
            }
            .article-content p {
                @apply text-dark dark:text-light leading-relaxed mb-4;
            }
            .article-content ul, .article-content ol {
                @apply text-dark dark:text-light mb-4 pl-6;
            }
            .article-content li {
                @apply mb-2;
            }
            .article-content strong {
                @apply font-bold text-primary dark:text-primary-dark;
            }
            .article-content code {
                @apply bg-accent dark:bg-accent-dark px-2 py-1 text-sm font-mono border border-dark dark:border-light;
            }
        </style>

        <script>
            // Reading progress
            document.addEventListener('DOMContentLoaded', () => {
                const article = document.querySelector('.article-content');
                const progressBar = document.getElementById('reading-progress');
                const progressText = document.getElementById('progress-text');
                
                if (article && progressBar && progressText) {
                    window.addEventListener('scroll', () => {
                        const articleTop = article.offsetTop - 200;
                        const articleHeight = article.offsetHeight;
                        const windowHeight = window.innerHeight;
                        const scrollTop = window.scrollY;
                        
                        const progress = Math.min(
                            Math.max((scrollTop - articleTop + windowHeight) / articleHeight, 0),
                            1
                        );
                        
                        const percentage = Math.round(progress * 100);
                        progressBar.style.width = `${percentage}%`;
                        progressText.textContent = `${percentage}%`;
                    });
                }
            });
        </script>
    </body>
</html>
