---
import PlatformLayout from '@layouts/PlatformLayout.astro';
import SidebarCard from '@components/platform/SidebarCard.astro';
import EmoticonLegend from '@components/platform/EmoticonLegend.astro';
import { EMOTICONS, parseEmoticons, getRank } from '@lib/kaskus';
import { mockThreadDetails, getThreadDetail } from '@data/mockThreadDetails';
import { marked } from 'marked';
import "@/styles/article.css";

// Static paths for all threads
export function getStaticPaths() {
  return Object.keys(mockThreadDetails).map(id => ({ params: { id } }));
}

// Get thread from params
const { id } = Astro.params;
const thread = getThreadDetail(id!);

if (!thread) {
  return Astro.redirect('/platform/discussions');
}

// Helper untuk render emoticons dan markdown
const e = (text: string) => parseEmoticons(text);

// Configure marked renderer for Prism.js classes
const renderer = new marked.Renderer();
renderer.code = function(code, language) {
  const lang = language || 'text';
  return `<pre><code class="language-${lang}">${code}</code></pre>`;
};

marked.setOptions({ renderer });

const renderMarkdown = (content: string) => {
  const withEmoticons = parseEmoticons(content);
  return marked(withEmoticons);
};

// Dynamic reply count calculation
const calculateReplyCount = (replies: any[]) => {
  let count = replies.length;
  replies.forEach(reply => {
    if (reply.nested && reply.nested.length > 0) {
      count += reply.nested.length;
    }
  });
  return count;
};

// Dynamic last activity calculation
const calculateLastActivity = (replies: any[]) => {
  if (replies.length === 0) return thread.lastActivity;
  
  let latestReply = replies[0];
  let latestTime = new Date(latestReply.createdAt.replace(' lalu', ''));
  
  replies.forEach(reply => {
    const replyTime = new Date(reply.createdAt.replace(' lalu', ''));
    if (replyTime > latestTime) {
      latestReply = reply;
      latestTime = replyTime;
    }
    
    if (reply.nested) {
      reply.nested.forEach((nested: any) => {
        const nestedTime = new Date(nested.createdAt.replace(' lalu', ''));
        if (nestedTime > latestTime) {
          latestReply = nested;
          latestTime = nestedTime;
        }
      });
    }
  });
  
  return latestReply.createdAt;
};

// Dynamic hot thread detection
const calculateIsHot = (cendol: number, replyCount: number, lastActivity: string) => {
  const recentActivity = lastActivity.includes('jam') || lastActivity.includes('menit');
  const highEngagement = cendol > 50 || replyCount > 20;
  return recentActivity && highEngagement;
};

// Override thread properties with dynamic calculations
const dynamicReplyCount = calculateReplyCount(thread.replies);
const dynamicLastActivity = calculateLastActivity(thread.replies);
const dynamicLastReplyBy = thread.replies.length > 0 ? 
  (thread.replies[thread.replies.length - 1].nested?.length > 0 ? 
    thread.replies[thread.replies.length - 1].nested[thread.replies[thread.replies.length - 1].nested.length - 1].author.name :
    thread.replies[thread.replies.length - 1].author.name) : '';
const dynamicIsHot = calculateIsHot(thread.cendol, dynamicReplyCount, dynamicLastActivity);

// Type config
const typeConfig: Record<string, { label: string; color: string }> = {
  ask: { label: 'ASK', color: 'bg-blue-100 text-blue-700' },
  share: { label: 'SHARE', color: 'bg-green-100 text-green-700' },
  tutorial: { label: 'TUTORIAL', color: 'bg-purple-100 text-purple-700' },
  debat: { label: 'DEBAT', color: 'bg-orange-100 text-orange-700' },
  megathread: { label: 'MEGATHREAD', color: 'bg-red-100 text-red-700' },
};

// Rank colors
const rankColors: Record<string, string> = {
  'Newbie': 'text-gray-500',
  'Kaskuser': 'text-blue-600',
  'Aktivis': 'text-green-600',
  'Kaskus Holic': 'text-purple-600',
  'Kaskus Addict': 'text-orange-600',
  'Kaskus Maniac': 'text-red-600',
  'Kaskus Geek': 'text-amber-600',
};

const typeInfo = typeConfig[thread.type || 'share'] || typeConfig.share;
const authorRankColor = rankColors[thread.author.rank] || 'text-gray-500';
---

<script>
  import { redirectIfGuest } from '../../../lib/router';
  redirectIfGuest();
</script>

<PlatformLayout title={thread.title} activeNav="/platform/discussions">
  <!-- Prism.js for syntax highlighting + KaTeX + Mermaid -->
  <Fragment slot="head">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs"></script>
    <style>
      /* Override article.css max-width for thread content */
      .article-content { max-width: none !important; }
      
      /* Active state for cendol/bata buttons */
      .cendol-btn.active { color: #16a34a !important; background: #dcfce7; }
      .bata-btn.active { color: #dc2626 !important; background: #fee2e2; }
      
      /* Mobile optimizations */
      @media (max-width: 768px) {
        .article-content { font-size: 16px; line-height: 1.6; }
        .article-content h1 { font-size: 1.5rem; }
        .article-content h2 { font-size: 1.25rem; }
        .article-content pre { margin: 1rem -1rem; border-radius: 0; }
        .article-content table { font-size: 0.875rem; }
      }
    </style>
  </Fragment>
  <!-- Breadcrumb -->
  <div class="text-sm text-gray-400 ml-2 mb-2">
    <a href="/platform/discussions" class="hover:text-green-600 transition">Forum</a>
    <span class="mx-2">â€º</span>
    <a href={`/platform/discussions?cat=${thread.category}`} class="hover:text-green-600 transition capitalize">{thread.category}</a>
  </div>

  <!-- Main Thread Card -->
  <article class="bg-white rounded-2xl shadow-sm overflow-hidden mb-4">
    <!-- Author Header -->
    <div class="p-5 flex items-start gap-3">
      <a href={`/platform/u/${thread.author.name}`} class="flex-shrink-0">
        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-lg font-bold">
          {thread.author.name.charAt(0).toUpperCase()}
        </div>
      </a>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 flex-wrap">
          <a href={`/platform/u/${thread.author.name}`} class="font-semibold text-gray-900 hover:underline">{thread.author.name}</a>
          <span class={`text-sm font-medium ${authorRankColor}`}>{thread.author.rank}</span>
          <span class="text-gray-400">Â·</span>
          <span class="text-gray-500 text-sm">{thread.lastActivity}</span>
        </div>
        <div class="flex items-center gap-2 mt-1">
          <span class={`text-xs px-2 py-0.5 rounded-full font-medium ${typeInfo.color}`}>{typeInfo.label}</span>
          {dynamicIsHot && <span class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-medium">ğŸ”¥ Hot</span>}
          {thread.isSolved && <span class="bg-green-500 text-white text-xs px-2 py-0.5 rounded-full font-medium">âœ“ Solved</span>}
        </div>
      </div>
    </div>

    <!-- Title -->
    <div class="px-6 pb-3">
      <h1 class="text-xl font-bold text-gray-900">{thread.title}</h1>
      {thread.tags && (
        <div class="flex gap-2 mt-2 flex-wrap">
          {thread.tags.map(tag => (
            <a href={`/platform/discussions?tag=${tag}`} class="text-sm text-green-600 hover:underline">#{tag}</a>
          ))}
        </div>
      )}
    </div>

    <!-- Content -->
    <div class="px-6 pb-6">
      <div class="article-content" set:html={renderMarkdown(thread.content)} />
      
      {thread.image && (
        <div class="mt-4 rounded-xl overflow-hidden">
          <img src={thread.image} alt={thread.title} class="w-full" />
        </div>
      )}

      {thread.signature && (
        <div class="mt-6 pt-4 border-t border-dashed border-gray-200 text-sm text-gray-500 italic">
          <p>{thread.signature}</p>
        </div>
      )}
    </div>

    <!-- Stats Bar -->
    <div class="px-6 py-2 border-t border-gray-100 flex items-center gap-4 text-sm text-gray-500">
      <span class="flex items-center gap-1">ğŸµ <strong class="text-green-600">{thread.cendol}</strong></span>
      {thread.bata > 0 && <span class="flex items-center gap-1">ğŸ§± <strong class="text-red-500">{thread.bata}</strong></span>}
      <span>{dynamicReplyCount} balasan</span>
      <span class="flex items-center gap-1">ğŸ‘ï¸ 2,341 views</span>
    </div>

    <!-- Action Bar -->
    <div class="px-6 py-3 border-t border-gray-100 flex items-center justify-between">
      <div class="flex items-center gap-1">
        <button class="flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-green-50 text-gray-600 hover:text-green-600 transition">
          <span>ğŸµ</span> <span class="font-medium">Cendol</span>
        </button>
        <button class="flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-red-50 text-gray-600 hover:text-red-500 transition">
          <span>ğŸ§±</span> <span class="font-medium">Bata</span>
        </button>
        <button class="flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100 text-gray-600 transition">
          <span>ğŸ’¬</span> <span class="font-medium">Reply</span>
        </button>
      </div>
      <div class="flex items-center gap-1">
        <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-500 transition" title="Share">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
          </svg>
        </button>
        <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-500 transition" title="Bookmark">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
          </svg>
        </button>
      </div>
    </div>
  </article>

  <!-- Replies Section -->
  <div class="bg-white rounded-2xl shadow-sm overflow-hidden mb-4">
    <div class="p-4 border-b border-gray-100">
      <h2 class="font-bold text-gray-900">{dynamicReplyCount} Balasan</h2>
    </div>

    {thread.replies.map((reply, index) => (
      <div class="border-b border-gray-50 group/reply">
        <div class="p-5">
          <div class="flex gap-3">
            <a href={`/platform/u/${reply.author.name}`} class="flex-shrink-0">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                {reply.author.name.charAt(0).toUpperCase()}
              </div>
            </a>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 flex-wrap">
                <a href={`/platform/u/${reply.author.name}`} class="font-semibold text-gray-900 hover:underline text-sm">{reply.author.name}</a>
                <span class={`text-xs font-medium ${rankColors[reply.author.rank] || 'text-gray-500'}`}>{reply.author.rank}</span>
                {reply.isPertamax && <span class="bg-yellow-400 text-yellow-900 text-xs px-2 py-0.5 rounded-full font-bold">ğŸ† PERTAMAX</span>}
                <span class="text-gray-400 text-xs">Â· {reply.createdAt}</span>
              </div>
              
              {reply.quote && (
                <div class="mt-2 bg-gray-50 border-l-4 border-blue-400 p-3 rounded-r-lg text-sm">
                  <p class="text-blue-600 font-medium mb-1">@{reply.quote.author} wrote:</p>
                  <p class="text-gray-600 italic">{reply.quote.text}</p>
                </div>
              )}
              
              <div class="mt-2 text-gray-800 article-content" set:html={renderMarkdown(reply.content)} />
              
              <div class="flex items-center gap-3 mt-3">
                <button class="cendol-btn flex items-center gap-1 text-sm text-gray-500 hover:text-green-600 transition" data-reply-id={reply.id} data-count={reply.cendol}>
                  <span>ğŸµ</span> <span class="font-medium cendol-count">{reply.cendol}</span>
                </button>
                {reply.bata > 0 && (
                  <button class="bata-btn flex items-center gap-1 text-sm text-gray-500 hover:text-red-500 transition" data-reply-id={reply.id} data-count={reply.bata}>
                    <span>ğŸ§±</span> <span class="font-medium bata-count">{reply.bata}</span>
                  </button>
                )}
                <button class="reply-btn text-sm text-gray-500 hover:text-gray-700 transition" data-reply-id={reply.id}>Reply</button>
                <button class="quote-btn text-sm text-gray-500 hover:text-gray-700 transition" data-reply-id={reply.id} data-author={reply.author.name} data-content={reply.content.substring(0, 100)}>Quote</button>
              </div>

              {/* Nested Replies */}
              {reply.nested && reply.nested.map(nested => (
                <div class="mt-4 pl-6 border-l-2 border-green-200">
                  <div class="flex gap-3">
                    <a href={`/platform/u/${nested.author.name}`} class="flex-shrink-0">
                      <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                        {nested.author.name.charAt(0).toUpperCase()}
                      </div>
                    </a>
                    <div class="flex-1">
                      <div class="flex items-center gap-2 flex-wrap">
                        <a href={`/platform/u/${nested.author.name}`} class="font-semibold text-gray-900 hover:underline text-sm">{nested.author.name}</a>
                        {nested.author.name === thread.author.name && <span class="bg-blue-100 text-blue-700 text-xs px-1.5 py-0.5 rounded font-medium">OP</span>}
                        <span class={`text-xs font-medium ${rankColors[nested.author.rank] || 'text-gray-500'}`}>{nested.author.rank}</span>
                        <span class="text-gray-400 text-xs">Â· {nested.createdAt}</span>
                      </div>
                      <div class="mt-1 text-gray-800 article-content" set:html={renderMarkdown(nested.content)} />
                      <div class="flex items-center gap-3 mt-2">
                        <button class="cendol-btn flex items-center gap-1 text-sm text-gray-500 hover:text-green-600 transition" data-reply-id={nested.id} data-count={nested.cendol}>
                          <span>ğŸµ</span> <span class="font-medium cendol-count">{nested.cendol}</span>
                        </button>
                        <button class="reply-btn text-sm text-gray-500 hover:text-gray-700 transition" data-reply-id={nested.id}>Reply</button>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    ))}

    {thread.replies.length === 0 && (
      <div class="p-8 text-center text-gray-500">
        <p>Belum ada balasan. Jadilah yang pertama! ğŸ†</p>
      </div>
    )}

    <!-- Load More -->
    {dynamicReplyCount > thread.replies.length && (
      <div class="p-4">
        <button class="w-full py-2 text-green-600 hover:bg-green-50 rounded-lg font-medium text-sm transition">
          Muat {dynamicReplyCount - thread.replies.length} balasan lainnya...
        </button>
      </div>
    )}
  </div>

  <!-- Quick Reply -->
  <div class="bg-white rounded-2xl shadow-sm p-4 mb-4">
    <div class="flex gap-3">
      <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-500 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
        U
      </div>
      <div class="flex-1">
        <textarea 
          id="reply-input"
          placeholder="Tulis balasan..." 
          class="w-full p-3 border border-gray-200 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
          rows="3"
        ></textarea>
        <div class="flex items-center justify-between mt-2">
          <div class="flex items-center gap-1">
            <button id="emoticon-shortcut" type="button" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition border border-gray-100" title="Pilih Emoticon">ğŸ˜€</button>
            <button type="button" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition border border-gray-100" title="Upload gambar">ğŸ“·</button>
            <button type="button" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition border border-gray-100" title="Code">ğŸ’»</button>
          </div>
          <button class="px-5 py-2 bg-green-600 text-white rounded-full font-medium hover:bg-green-700 transition">
            Kirim
          </button>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // Scroll to emoticon legend when shortcut clicked
    document.getElementById('emoticon-shortcut')?.addEventListener('click', () => {
      const legend = document.getElementById('emoticon-legend');
      if (legend) {
        legend.scrollIntoView({ behavior: 'smooth', block: 'center' });
        legend.classList.add('ring-2', 'ring-green-500', 'ring-offset-2');
        setTimeout(() => legend.classList.remove('ring-2', 'ring-green-500', 'ring-offset-2'), 2000);
      }
    });

    // Trigger Prism.js syntax highlighting after page load
    document.addEventListener('DOMContentLoaded', () => {
      if (window.Prism) {
        window.Prism.highlightAll();
      }

      // Initialize KaTeX with content detection
      const hasMath = document.querySelector('.math-content') || document.body.textContent.includes('$');
      if (hasMath) {
        import('https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.mjs').then(({ default: katex }) => {
          const walker = document.createTreeWalker(
            document.body, 
            NodeFilter.SHOW_TEXT, 
            node => {
              // Skip already processed elements and script/style tags
              const parent = node.parentElement;
              return parent?.closest('pre, code, script, style, .katex-html, .katex') ? 
                NodeFilter.FILTER_REJECT : NodeFilter.FILTER_ACCEPT;
            }
          );
          const textNodes = [];
          let node;
          while (node = walker.nextNode()) {
            if (node.textContent?.includes('$')) textNodes.push(node);
          }

          textNodes.forEach(textNode => {
            const text = textNode.textContent || '';
            
            // Process both $$ and $ patterns
            if (text.includes('$')) {
              // More robust regex to handle incomplete $ patterns
              const parts = text.split(/(\$\$[^$]*\$\$|\$[^$\n]*\$)/g);
              if (parts.length > 1) {
                const fragment = document.createDocumentFragment();
                parts.forEach(part => {
                  if (part.startsWith('$$') && part.endsWith('$$') && part.length > 4) {
                    const tex = part.slice(2, -2).trim();
                    if (tex) {
                      const div = document.createElement('div');
                      div.className = 'math-block';
                      try {
                        div.innerHTML = katex.renderToString(tex, { 
                          displayMode: true, 
                          throwOnError: false,
                          output: 'mathml'
                        });
                      } catch { div.textContent = part; }
                      fragment.appendChild(div);
                    } else {
                      fragment.appendChild(document.createTextNode(part));
                    }
                  } else if (part.startsWith('$') && part.endsWith('$') && part.length > 2) {
                    const tex = part.slice(1, -1).trim();
                    if (tex) {
                      const span = document.createElement('span');
                      span.className = 'math-inline';
                      try {
                        span.innerHTML = katex.renderToString(tex, { 
                          displayMode: false, 
                          throwOnError: false,
                          output: 'mathml'
                        });
                      } catch { span.textContent = part; }
                      fragment.appendChild(span);
                    } else {
                      fragment.appendChild(document.createTextNode(part));
                    }
                  } else if (part) {
                    fragment.appendChild(document.createTextNode(part));
                  }
                });
                textNode.replaceWith(fragment);
              }
            }
          });
          console.log('âœ… KaTeX rendered successfully');
        }).catch(e => console.log('âš ï¸ KaTeX not needed:', e.message));
      }

      // Initialize Mermaid with content detection
      const hasMermaid = document.querySelector('.mermaid') || Array.from(document.querySelectorAll('pre code')).some(block => 
        /^(flowchart|graph|pie|sequenceDiagram)/m.test(block.textContent || '')
      );
      if (hasMermaid) {
        import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs').then(({ default: mermaid }) => {
          mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose'
          });
          mermaid.run().catch(() => {});
          console.log('âœ… Mermaid initialized successfully');
        }).catch(e => console.log('âš ï¸ Mermaid not needed:', e.message));
      }
    });

    // Cendol/Bata functionality with real-time sync
    document.querySelectorAll('.cendol-btn, .bata-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const count = parseInt(this.dataset.count);
          const countEl = this.querySelector('.cendol-count, .bata-count');
          const isCendol = this.classList.contains('cendol-btn');
          
          // Toggle active state
          if (this.classList.contains('active')) {
            this.classList.remove('active');
            countEl.textContent = count - 1;
            this.dataset.count = count - 1;
          } else {
            this.classList.add('active');
            countEl.textContent = count + 1;
            this.dataset.count = count + 1;
            
            // Update main thread stats
            if (this.closest('.bg-white.rounded-2xl.shadow-sm')) {
              const mainStats = document.querySelector('.px-6.py-2.border-t .text-green-600, .px-6.py-2.border-t .text-red-500');
              if (mainStats && isCendol) {
                const currentMainCount = parseInt(mainStats.textContent);
                mainStats.textContent = currentMainCount + 1;
              }
            }
            
            // Show feedback
            const feedback = document.createElement('div');
            feedback.textContent = isCendol ? '+1 Cendol!' : '+1 Bata!';
            feedback.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white text-sm z-50 ${isCendol ? 'bg-green-500' : 'bg-red-500'}`;
            document.body.appendChild(feedback);
            setTimeout(() => feedback.remove(), 2000);
          }
        });
      });

      // Reply functionality
      document.querySelectorAll('.reply-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const replyInput = document.getElementById('reply-input');
          if (replyInput) {
            replyInput.focus();
            replyInput.placeholder = `Membalas ${this.dataset.replyId}...`;
          }
        });
      });

      // Quote functionality
      document.querySelectorAll('.quote-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const replyInput = document.getElementById('reply-input');
          const author = this.dataset.author;
          const content = this.dataset.content;
          
          if (replyInput) {
            const quote = `> **@${author} wrote:**\n> ${content}...\n\n`;
            replyInput.value = quote;
            replyInput.focus();
            replyInput.setSelectionRange(replyInput.value.length, replyInput.value.length);
          }
        });
      });
  </script>

  <!-- Right Sidebar -->
  <Fragment slot="sidebar">
    <!-- Author Info Card -->
    <SidebarCard title="Tentang Penulis">
      <div class="space-y-4">
        <!-- Author Profile -->
        <div class="flex items-start gap-3">
          <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl font-bold shadow-lg">
            {thread.author.name.charAt(0).toUpperCase()}
          </div>
          <div class="flex-1 min-w-0">
            <h4 class="font-bold text-gray-900 dark:text-gray-100 text-lg">{thread.author.name}</h4>
            <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">{thread.author.rank}</p>
            <div class="flex items-center gap-3 mt-2 text-xs text-gray-500">
              <span>ğŸ“ {thread.author.posts} posts</span>
              <span>ğŸ‘¥ 1.2K followers</span>
            </div>
          </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-2 gap-3">
          <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-3 text-center">
            <div class="text-lg font-bold text-green-600 dark:text-green-400">{thread.cendol}</div>
            <div class="text-xs text-green-700 dark:text-green-300">Total Cendol</div>
          </div>
          <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-center">
            <div class="text-lg font-bold text-blue-600 dark:text-blue-400">89%</div>
            <div class="text-xs text-blue-700 dark:text-blue-300">Helpful Rate</div>
          </div>
        </div>

        <!-- Activity Info -->
        <div class="space-y-2 text-xs">
          <div class="flex items-center justify-between">
            <span class="text-gray-600 dark:text-gray-400">ğŸ“… Bergabung:</span>
            <span class="font-medium">2 tahun lalu</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-gray-600 dark:text-gray-400">âš¡ Terakhir aktif:</span>
            <span class="font-medium text-green-600">1 jam lalu</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-gray-600 dark:text-gray-400">ğŸ† Kontribusi:</span>
            <span class="font-medium">45 thread</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-2 pt-2 border-t border-gray-100 dark:border-gray-700">
          <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition shadow-sm">
            ğŸ‘¤ Follow
          </button>
          <button class="bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium py-2 px-3 rounded-lg transition">
            ğŸ’¬ Message
          </button>
        </div>

        <!-- Badges/Achievements -->
        <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
          <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">Achievements:</div>
          <div class="flex flex-wrap gap-1">
            <span class="bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 text-xs px-2 py-1 rounded-full">ğŸ† Top Contributor</span>
            <span class="bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 text-xs px-2 py-1 rounded-full">âœ… Verified</span>
            <span class="bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400 text-xs px-2 py-1 rounded-full">ğŸ”¬ Physics Expert</span>
          </div>
        </div>
      </div>
    </SidebarCard>

    <SidebarCard title="Thread Terkait">
      <div class="space-y-3">
        <a href="/platform/discussions/derivasi-persamaan-schrodinger-dari-prinsip-varias-l3m4n5o6p7q8" class="block hover:text-green-600 transition">
          <p class="text-sm font-medium line-clamp-2">Derivasi Persamaan SchrÃ¶dinger dari prinsip variasi</p>
          <p class="text-xs text-gray-400 mt-1">45 balasan</p>
        </a>
        <a href="/platform/discussions/kenapa-momentum-angular-kekal-tapi-energi-kinetik-r9s0t1u2v3w4" class="block hover:text-green-600 transition">
          <p class="text-sm font-medium line-clamp-2">Kenapa momentum angular kekal tapi energi kinetik tidak?</p>
          <p class="text-xs text-gray-400 mt-1">12 balasan</p>
        </a>
        <a href="/platform/discussions/bikin-sensor-suhu-lcd-dengan-arduino-untuk-eksperi-x5y6z7a8b9c0" class="block hover:text-green-600 transition">
          <p class="text-sm font-medium line-clamp-2">Bikin sensor suhu + LCD dengan Arduino</p>
          <p class="text-xs text-gray-400 mt-1">34 balasan</p>
        </a>
      </div>
    </SidebarCard>

    <SidebarCard title="Emoticon Legend">
      <EmoticonLegend />
    </SidebarCard>
  </Fragment>
</PlatformLayout>
