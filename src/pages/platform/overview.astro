---
import PlatformLayout from '@layouts/PlatformLayout.astro';
---

<script>
  import { redirectIfGuest } from '../../lib/router';
  redirectIfGuest();
</script>

<PlatformLayout title="Overview" activeNav="/platform/overview">
  <!-- Welcome Header -->
  <div class="bg-gradient-to-r from-green-500 to-teal-500 rounded-2xl p-6 text-white mb-6">
    <h1 class="text-2xl font-bold mb-2">Selamat datang kembali! ğŸ‘‹</h1>
    <p class="text-green-100" id="welcome-name">Loading...</p>
  </div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded-2xl p-5 shadow-sm">
      <div class="text-3xl mb-3">ğŸ“</div>
      <div class="text-2xl font-bold text-gray-900 mb-1" id="stat-posts">0</div>
      <div class="text-xs text-gray-500">Total Posts</div>
    </div>
    <div class="bg-white rounded-2xl p-5 shadow-sm">
      <div class="text-3xl mb-3">ğŸ¥’</div>
      <div class="text-2xl font-bold text-green-600 mb-1" id="stat-cendol">0</div>
      <div class="text-xs text-gray-500">Cendol</div>
    </div>
    <div class="bg-white rounded-2xl p-5 shadow-sm">
      <div class="text-3xl mb-3">ğŸ”¬</div>
      <div class="text-2xl font-bold text-blue-600 mb-1" id="stat-projects">0</div>
      <div class="text-xs text-gray-500">Proyek</div>
    </div>
    <div class="bg-white rounded-2xl p-5 shadow-sm">
      <div class="text-3xl mb-3">â­</div>
      <div class="text-2xl font-bold text-orange-500 mb-1" id="stat-reputation">0</div>
      <div class="text-xs text-gray-500">Reputasi</div>
    </div>
  </div>

  <div class="grid md:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="md:col-span-2 space-y-6">
      <!-- Activity Chart -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h2 class="font-bold text-lg mb-6 flex items-center gap-2">
          <span class="text-xl">ğŸ“Š</span> Aktivitas Mingguan
        </h2>
        <div class="h-40 flex items-end justify-between gap-3 px-2">
          <div class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-green-200 rounded-t" style="height: 30%"></div>
            <span class="text-xs text-gray-500">Sen</span>
          </div>
          <div class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-green-300 rounded-t" style="height: 50%"></div>
            <span class="text-xs text-gray-500">Sel</span>
          </div>
          <div class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-green-400 rounded-t" style="height: 70%"></div>
            <span class="text-xs text-gray-500">Rab</span>
          </div>
          <div class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-green-300 rounded-t" style="height: 45%"></div>
            <span class="text-xs text-gray-500">Kam</span>
          </div>
          <div class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-green-500 rounded-t" style="height: 90%"></div>
            <span class="text-xs text-gray-500">Jum</span>
          </div>
          <div class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-green-200 rounded-t" style="height: 25%"></div>
            <span class="text-xs text-gray-500">Sab</span>
          </div>
          <div class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-green-100 rounded-t" style="height: 15%"></div>
            <span class="text-xs text-gray-500">Min</span>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h2 class="font-bold text-lg mb-6 flex items-center gap-2">
          <span class="text-xl">ğŸ•</span> Aktivitas Terbaru
        </h2>
        <div class="space-y-4">
          <div class="flex gap-4 p-4 bg-gray-50 rounded-xl">
            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-sm flex-shrink-0">ğŸ¥’</div>
            <div class="flex-1">
              <p class="text-sm text-gray-800 mb-1">Kamu mendapat <strong class="text-green-600">+5 cendol</strong> dari postingan</p>
              <p class="text-xs text-gray-400">2 jam lalu</p>
            </div>
          </div>
          <div class="flex gap-4 p-4 bg-gray-50 rounded-xl">
            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-sm flex-shrink-0">ğŸ’¬</div>
            <div class="flex-1">
              <p class="text-sm text-gray-800 mb-1"><strong>Siti</strong> membalas diskusimu</p>
              <p class="text-xs text-gray-400">5 jam lalu</p>
            </div>
          </div>
          <div class="flex gap-4 p-4 bg-gray-50 rounded-xl">
            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-sm flex-shrink-0">ğŸ‘¥</div>
            <div class="flex-1">
              <p class="text-sm text-gray-800 mb-1"><strong>Ahmad</strong> mulai mengikutimu</p>
              <p class="text-xs text-gray-400">1 hari lalu</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Quick Actions -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h2 class="font-bold text-lg mb-6 flex items-center gap-2">
          <span class="text-xl">âš¡</span> Aksi Cepat
        </h2>
        <div class="space-y-3">
          <a href="/platform/feed" class="flex items-center gap-4 p-4 bg-gray-50 hover:bg-green-50 rounded-xl transition">
            <span class="text-lg">ğŸ“°</span>
            <span class="text-sm font-medium">Lihat Feed</span>
          </a>
          <a href="/platform/projects/new" class="flex items-center gap-4 p-4 bg-gray-50 hover:bg-green-50 rounded-xl transition">
            <span class="text-lg">ğŸ”¬</span>
            <span class="text-sm font-medium">Buat Proyek Baru</span>
          </a>
          <a href="/platform/discussions" class="flex items-center gap-4 p-4 bg-gray-50 hover:bg-green-50 rounded-xl transition">
            <span class="text-lg">ğŸ’¬</span>
            <span class="text-sm font-medium">Mulai Diskusi</span>
          </a>
        </div>
      </div>

      <!-- Rank Progress -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h2 class="font-bold text-lg mb-6 flex items-center gap-2">
          <span class="text-xl">ğŸ†</span> Rank Progress
        </h2>
        <div class="text-center py-4">
          <div class="text-4xl mb-3">â­</div>
          <div class="font-bold text-gray-900 mb-1" id="rank-title">Kaskuser</div>
          <div class="text-sm text-gray-500" id="rank-posts">0 posts</div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2 mt-4">
          <div class="bg-gradient-to-r from-green-400 to-teal-500 h-2 rounded-full" id="rank-progress" style="width: 10%"></div>
        </div>
        <p class="text-xs text-gray-500 mt-3 text-center" id="rank-next">50 posts lagi ke Kaskus Addict</p>
      </div>

      <!-- Goals -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h2 class="font-bold text-lg mb-6 flex items-center gap-2">
          <span class="text-xl">ğŸ¯</span> Target Minggu Ini
        </h2>
        <div class="space-y-4">
          <div>
            <div class="flex justify-between text-sm mb-2">
              <span class="text-gray-600">Post 3 konten</span>
              <span class="text-green-600 font-medium">2/3</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="bg-green-500 h-2 rounded-full" style="width: 66%"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-sm mb-2">
              <span class="text-gray-600">Bantu 5 diskusi</span>
              <span class="text-orange-500 font-medium">1/5</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="bg-orange-400 h-2 rounded-full" style="width: 20%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</PlatformLayout>

<script>
  import { getUser } from '../../lib/localStorage';
  
  const user = getUser();
  if (user) {
    const welcomeName = document.getElementById('welcome-name');
    if (welcomeName) welcomeName.textContent = `Lihat perkembangan aktivitasmu, ${user.name?.split(' ')[0] || 'Member'}`;
    
    document.getElementById('stat-posts')!.textContent = String(user.posts || 0);
    document.getElementById('stat-cendol')!.textContent = String(user.cendol || 0);
    document.getElementById('stat-projects')!.textContent = String(user.projects || 0);
    document.getElementById('stat-reputation')!.textContent = String((user.cendol || 0) - (user.bata || 0));
    
    document.getElementById('rank-posts')!.textContent = `${user.posts || 0} posts`;
    
    const progress = Math.min(((user.posts || 0) / 50) * 100, 100);
    document.getElementById('rank-progress')!.style.width = `${progress}%`;
  }
</script>
