---
import PlatformLayout from '@layouts/PlatformLayout.astro';
import { getRank, RANKS } from '@lib/kaskus';
---

<script>
  import { redirectIfGuest } from '../../lib/router';
  redirectIfGuest();
</script>

<PlatformLayout title="Profile" activeNav="/platform/profile">
  <div class="max-w-4xl mx-auto">
    <!-- Profile Card Kaskus Style -->
    <div class="bg-white rounded-2xl shadow-sm overflow-hidden mb-6">
      <!-- Banner -->
      <div class="h-32 bg-gradient-to-r from-green-600 via-teal-500 to-blue-600"></div>
      
      <div class="px-6 pb-6">
        <div class="flex flex-col sm:flex-row gap-4 -mt-12">
          <div id="avatar" class="w-24 h-24 bg-blue-600 rounded-xl border-4 border-white shadow-lg flex items-center justify-center text-white text-3xl font-bold flex-shrink-0">
            M
          </div>
          <div class="flex-1 pt-2 sm:pt-12">
            <div class="flex items-start justify-between">
              <div>
                <h1 id="profile-name" class="text-2xl font-bold">Member</h1>
                <p id="profile-username" class="text-gray-500">@member</p>
                <div class="flex items-center gap-2 mt-1">
                  <span id="rank-badge" class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-sm font-medium">Newbie</span>
                </div>
              </div>
              <button class="px-4 py-2 border border-gray-200 rounded-lg text-sm hover:bg-gray-50">âœï¸ Edit Profile</button>
            </div>
          </div>
        </div>

        <!-- Stats Kaskus Style -->
        <div class="grid grid-cols-5 gap-4 mt-6 pt-6 border-t text-center">
          <div>
            <div class="text-2xl font-bold text-gray-700">156</div>
            <div class="text-xs text-gray-500">Posts</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-green-600">ğŸ¥’ 234</div>
            <div class="text-xs text-gray-500">Cendol</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-red-600">ğŸ§± 12</div>
            <div class="text-xs text-gray-500">Bata</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-blue-600">3</div>
            <div class="text-xs text-gray-500">Proyek</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-purple-600">28</div>
            <div class="text-xs text-gray-500">Thread</div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid lg:grid-cols-3 gap-6">
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Contribution Graph -->
        <div class="bg-white rounded-xl border border-gray-100 p-6">
          <h2 class="font-bold mb-4">ğŸ“Š Aktivitas Posting</h2>
          <div class="grid grid-cols-12 gap-1">
            {Array.from({length: 48}).map((_, i) => (
              <div class={`w-full aspect-square rounded-sm ${
                Math.random() > 0.7 ? 'bg-green-500' : 
                Math.random() > 0.5 ? 'bg-green-300' : 
                Math.random() > 0.3 ? 'bg-green-100' : 'bg-gray-100'
              }`}></div>
            ))}
          </div>
          <p class="text-sm text-gray-500 mt-3">28 posts dalam 30 hari terakhir</p>
        </div>

        <!-- Recent Posts -->
        <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
          <div class="bg-gray-100 px-4 py-3 font-bold border-b border-gray-100">ğŸ“ Thread Terbaru</div>
          <div class="divide-y">
            <a href="#" class="block p-4 hover:bg-gray-50">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-green-500">ğŸ¥’ +89</span>
                <span class="text-xs text-gray-400">67 replies</span>
              </div>
              <div class="font-medium text-blue-800 hover:underline">[SHARE] Berhasil bikin interferometer Michelson dari cermin bekas!</div>
              <div class="text-xs text-gray-500 mt-1">Forum Eksperimen â€¢ 5 jam lalu</div>
            </a>
            <a href="#" class="block p-4 hover:bg-gray-50">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-green-500">ğŸ¥’ +45</span>
                <span class="text-xs text-gray-400">23 replies</span>
              </div>
              <div class="font-medium text-blue-800 hover:underline">[TUTORIAL] Cara mudah memahami persamaan SchrÃ¶dinger</div>
              <div class="text-xs text-gray-500 mt-1">Forum Fisika Modern â€¢ 3 hari lalu</div>
            </a>
            <a href="#" class="block p-4 hover:bg-gray-50">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-green-500">ğŸ¥’ +32</span>
                <span class="text-xs text-gray-400">15 replies</span>
              </div>
              <div class="font-medium text-blue-800 hover:underline">[ASK] Rekomendasi buku fisika matematika?</div>
              <div class="text-xs text-gray-500 mt-1">Forum Karir & Kuliah â€¢ 1 minggu lalu</div>
            </a>
          </div>
        </div>

        <!-- Recent Replies -->
        <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
          <div class="bg-gray-100 px-4 py-3 font-bold border-b border-gray-100">ğŸ’¬ Balasan Terbaru</div>
          <div class="divide-y">
            <div class="p-4">
              <div class="text-sm text-gray-500 mb-2">
                Membalas thread <a href="#" class="text-blue-600 hover:underline">Kenapa langit berwarna biru?</a>
              </div>
              <p class="text-gray-700">"Ini karena hamburan Rayleigh gan. Cahaya biru punya panjang gelombang lebih pendek..."</p>
              <div class="text-xs text-gray-400 mt-2">2 jam lalu â€¢ ğŸ¥’ +5</div>
            </div>
            <div class="p-4">
              <div class="text-sm text-gray-500 mb-2">
                Membalas thread <a href="#" class="text-blue-600 hover:underline">Tips lolos OSN Fisika</a>
              </div>
              <p class="text-gray-700">"Setuju sama agan di atas. Latihan soal itu kunci, tapi jangan lupa..."</p>
              <div class="text-xs text-gray-400 mt-2">1 hari lalu â€¢ ğŸ¥’ +12</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Info Box -->
        <div class="bg-white rounded-xl border border-gray-100 p-4">
          <h3 class="font-bold mb-3">â„¹ï¸ Info</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-500">Bergabung</span>
              <span id="profile-joined">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">Universitas</span>
              <span id="profile-university">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">Jurusan</span>
              <span id="profile-major">-</span>
            </div>
          </div>
        </div>

        <!-- Rank Progress -->
        <div class="bg-white rounded-xl border border-gray-100 p-4">
          <h3 class="font-bold mb-3">ğŸ† Rank Progress</h3>
          <div class="space-y-2">
            {RANKS.map((rank, i) => (
              <div class="flex items-center gap-2 text-sm">
                <div class={`w-3 h-3 rounded-full ${i <= 2 ? 'bg-green-500' : 'bg-gray-200'}`}></div>
                <span class={i <= 2 ? 'font-medium' : 'text-gray-400'}>{rank.title}</span>
                <span class="text-xs text-gray-400 ml-auto">{rank.min}+ posts</span>
              </div>
            ))}
          </div>
        </div>

        <!-- Badges -->
        <div class="bg-white rounded-xl border border-gray-100 p-4">
          <h3 class="font-bold mb-3">ğŸ… Badges</h3>
          <div class="flex flex-wrap gap-2">
            <span class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-sm">ğŸŒŸ Early Member</span>
            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">ğŸ¥’ Cendol Lover</span>
            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">ğŸ’¬ Active Poster</span>
            <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm">ğŸ”¬ Experimenter</span>
          </div>
        </div>

        <!-- Signature -->
        <div class="bg-white rounded-xl border border-gray-100 p-4">
          <h3 class="font-bold mb-3">âœï¸ Signature</h3>
          <div class="text-sm text-gray-600 italic border-l-2 border-gray-300 pl-3">
            "Physics is like sex: sure, it may give some practical results, but that's not why we do it."
            <div class="text-xs text-gray-400 mt-1">- Richard Feynman</div>
          </div>
          <button class="text-xs text-blue-600 hover:underline mt-2">Edit signature</button>
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    const member = localStorage.getItem('kf13-member');
    if (member) {
      const data = JSON.parse(member);
      document.getElementById('profile-name').textContent = data.name || 'Member';
      document.getElementById('profile-username').textContent = '@' + (data.name?.toLowerCase().replace(/\s+/g, '_') || 'member');
      document.getElementById('profile-university').textContent = data.university || '-';
      document.getElementById('profile-major').textContent = data.major || '-';
      document.getElementById('avatar').textContent = (data.name || 'M')[0].toUpperCase();
      if (data.created_at) {
        document.getElementById('profile-joined').textContent = new Date(data.created_at).toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
      }
    }
  </script>
</PlatformLayout>
